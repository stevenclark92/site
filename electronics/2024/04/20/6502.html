<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <!-- Accessibility adjustments needed -->
    <!-- Site title & meta -->
  </head>

  <body class="dark:bg-zinc-800 dark:text-slate-50">

    <header class="fixed w-full p-4 flex justify-between items-center shadow dark:shadow-none dark:bg-zinc-800 bg-slate-50">
      <p id="logo" class="text-xl font-medium"><a href="http://localhost:4000/">steveclark<span class="text-yellow-400">.</span>io</a></p>
      <nav>
        <a class="" href="/notes">Notes</a>
        <a class="px-2"href="/">About</a>
      </nav>
    </header>


    <div class="container min-h-svh mx-auto place-content-center">
      <main class="px-8 m-auto prose dark:prose-invert">
        <div class="py-20">
<h2 id="notes">Notes</h2>

<p>Rockwell 6502 and 65C02 chips can’t single cycle based on the clock signal the same way as WD processors can. In order to single cycle these chips, it’s better to pull RDY low. Depending on the specific model the outcome will be different.</p>

<ul>
  <li>For the NMOS 6502, pulling RDY low will hold state on a read operation. Write operations will finish with state only held on the next read.</li>
  <li>For the CMOS 65C02, pulling RDY low will hold the state regardless of the current operation type.</li>
</ul>

<p>This is important as outputs will differ based on the specific processor in use.</p>

<p>Should I wish to try and single-clock the 65C02, the clock must be held <em>high</em> not <em>low</em>. Single stepping involves pulling the signal low for no longer than 5 microseconds. Longer than this and the integrity of data stored in registers cannot be guaranteed.</p>

<p>The NMOS 6502 cannot be held in either state.</p>

<h3 id="interfacing-with-esp32-serial-monitor">Interfacing with ESP32 Serial Monitor</h3>

<p>There are two ways I can see to single step these chips using the ESP32 Serial Monitor tool I wrote; The first of these will only work for the CMOS 65C02:</p>

<ul>
  <li>Provide the 65C02 with a constant high signal from the ESP32 on the clock in pin.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">delayMicroseconds(5)</code> in the Arduino IDE to pulse the clock low to cycle the clock.</li>
  <li>Pull the pin high again at the end of this delay.</li>
</ul>

<p>Rough Arduino sketch of this approach can be found here: https://github.com/stevenclark92/stESP32/blob/main/stESP32_clockPulse.ino. It’s pretty janky but works more or less. Not a practical solution in current form.</p>

<p>I need to explore the accuracy of these delay pulses to ensure the data in registers is still valid. /todo</p>

<p>The second method I can see that would work on both processors is:</p>

<ul>
  <li>Provide a clock signal using a hardware clock. I’ll use 1 MHz for testing.</li>
  <li>Pull RDY (pin 2) low using the ESP32.</li>
  <li>Pulse RDY using <code class="language-plaintext highlighter-rouge">delayMicroseconds(1)</code> for single steps that match the 1 MHz clock frequency.</li>
</ul>

<p>This will depend on how well the microcontroller is able to accurately pulse for such short periods. Equally, the NMOS chip will continue performing writes until the next read instruction. I need to ensure - if possible - that I am able to read from the bus quickly enough that no steps are missed. It’s very hard to do this via serial at 1 MHz. It might be best to clock the NMOS chip down to its lowest stable configuration - I think it’s 100 KHz. I should be able to do this using Schmitt triggers, provided they provide a clean and stable enough signal.</p>

<p>Onwards and upwards.</p>

</div>
      </main>
    </div>


  <footer class="p-2 fixed bottom-0 w-full flex justify-between dark:bg-zinc-800 bg-slate-50">
    <div class="socials flex">
    <p class="px-2 text-sm italic text-left text-slate-500 dark:text-slate-300"><a href="https://github.com/stevenclark92">GitHub.</a></p>
    <p class="pr-2 text-sm italic text-left text-slate-500 dark:text-slate-300"><a href="https://www.linkedin.com/in/stevenjc/">LinkedIn.</a></p>
    </div>
    <p class="text-sm italic text-right text-slate-400 dark:text-slate-200">© 2024</p>
  </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
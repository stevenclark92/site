<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <!-- Accessibility adjustments needed -->
    <!-- Site title & meta -->
    <title>6502 - ESP32 Interface | steveclark.io</title>
  </head>

  <body class="dark:bg-zinc-800 dark:text-slate-50">
    <header class="fixed p-8 font-light max-lg:hidden top-10 left-10">
  <h1 id="logo-mb" class="text-2xl">
    <a href="https://steveclark.io/">steveclark<span class="text-yellow-400">.</span>io
    </a>
  </h1>
  <nav class="*:py-1">
    <p class="mt-8"><span class="text-yellow-400 pr-2">/</span><a href="/notes">notes</a></p>
    <p><span class="text-yellow-400 pr-2">/</span><a href="/projects">projects</a></p>
    <p><span class="text-yellow-400 pr-2">/</span><a href="/about">about</a></p>
    <p class="mt-4"><span class="text-blue-400 pr-2">|</span><a href="https://github.com/stevenclark92">github</a></p>
    <p><span class="text-blue-400 pr-2">|</span><a href="https://www.linkedin.com/in/stevenjc/">linkedin</a><p>
  </nav>
</header>  

<header class="p-4 font-light lg:hidden flex items-center justify-between shadow mb-4">
  <h1 id="logo-mb" class="text-2xl">
    <a href="https://steveclark.io/">sc<span class="text-yellow-400">.</span>io
    </a>
  </h1>
  <nav class="*:py-1 *:inline">
    <p class="mt-8"><span class="text-yellow-400">/ </span><a href="/notes">notes</a></p>
    <p><span class="text-yellow-400">/ </span><a href="/projects">projects</a></p>
    <p><span class="text-yellow-400">/ </span><a href="/about">about</a></p>
  </nav>
</header>
    <main class="shrink">
    <div class="prose prose-headings:font-normal prose-a:font-normal dark:prose-invert mx-auto p-8 max-md:p-4 lg:my-10 mb-4">

<div class="categories font-semibold flex justify-between align-top *:mt-0">
    <p
      class="text-transparent bg-clip-text bg-gradient-to-br from-blue-300 to-indigo-500 lowercase"
    >
      @Electronics
    </p>
    <div class="tags *:inline *:text-xs">
    
    <p
      class="text-transparent bg-clip-text bg-gradient-to-br from-yellow-300 to-amber-500 lowercase"
    >
      [Stub]
    </p>
    
    <p
      class="text-transparent bg-clip-text bg-gradient-to-br from-yellow-300 to-amber-500 lowercase"
    >
      [Notes]
    </p>
    
</div>
  </div>

<h1
  class="head flex justify-between mb-4 items-baseline">6502 - ESP32 Interface</h1>

<div class="shrink-0 flex justify-between pt-2">
    <p class="m-0 text-sm font-semibold align">April 20, 2024</p>
</div>

<p>Rockwell 6502 and 65C02 chips can’t single cycle based on the clock signal the same way as WD processors can. In order to single cycle these chips, it’s better to pull RDY low. Depending on the specific model the outcome will be different.</p>

<ul>
  <li>For the NMOS 6502, pulling RDY low will hold state on a read operation. Write operations will finish with state only held on the next read.</li>
  <li>For the CMOS 65C02, pulling RDY low will hold the state regardless of the current operation type.</li>
</ul>

<p>This is important as outputs will differ based on the specific processor in use.</p>

<p>Should I wish to try and single-clock the 65C02, the clock must be held <em>high</em> not <em>low</em>. Single stepping involves pulling the signal low for no longer than 5 microseconds. Longer than this and the integrity of data stored in registers cannot be guaranteed.</p>

<p>The NMOS 6502 cannot be held in either state.</p>

<h3 id="interfacing-with-esp32-serial-monitor">Interfacing with ESP32 Serial Monitor</h3>

<p>There are two ways I can see to single step these chips using the ESP32 Serial Monitor tool I wrote; The first of these will only work for the CMOS 65C02:</p>

<ul>
  <li>Provide the 65C02 with a constant high signal from the ESP32 on the clock in pin.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">delayMicroseconds(5)</code> in the Arduino IDE to pulse the clock low to cycle the clock.</li>
  <li>Pull the pin high again at the end of this delay.</li>
</ul>

<p>Rough Arduino sketch of this approach can be found <a href="https://github.com/stevenclark92/stESP32/blob/main/stESP32_clockPulse.ino">here</a>. It’s pretty janky but works more or less. Not a practical solution in current form.</p>

<p>I need to explore the accuracy of these delay pulses to ensure the data in registers is still valid. /todo</p>

<p>The second method I can see that would work on both processors is:</p>

<ul>
  <li>Provide a clock signal using a hardware clock. I’ll use 1 MHz for testing.</li>
  <li>Pull RDY (pin 2) low using the ESP32.</li>
  <li>Pulse RDY using <code class="language-plaintext highlighter-rouge">delayMicroseconds(1)</code> for single steps that match the 1 MHz clock frequency.</li>
</ul>

<p>This will depend on how well the microcontroller is able to accurately pulse for such short periods. Equally, the NMOS chip will continue performing writes until the next read instruction. I need to ensure - if possible - that I am able to read from the bus quickly enough that no steps are missed. It’s very hard to do this via serial at 1 MHz. It might be best to clock the NMOS chip down to its lowest stable configuration - I think it’s 100 KHz. I should be able to do this using Schmitt triggers, provided they provide a clean and stable enough signal.</p>

<p>Onwards and upwards.</p>

</div>
    </div>
    </main>


    <footer class="fixed text-xs bg-inherit rounded-md text-zinc-500 bottom-0 left-0">
      <p class="p-2 lg:m-16">© Steve Clark 2024</p>
    </footer>


    <!-- JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  
  </body>
</html>